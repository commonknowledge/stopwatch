{% extends "base.html" %}
{% load django_bootstrap5 static ckbootstrap_tags ckdjango_tags wagtailembeds_tags wagtailimages_tags %}

{% block content %}

<header class="position-relative block-lg bg-panel border-2 border-primary">
  <div class="position-absolute z-2 h-100 w-100 d-flex flex-column justify-content-end">
    <h1 class="px-3 ">{{self.title}}</h1>
  </div>
  
  {% image self.photo height-600 class="img-fluid opacity-50 block-lg cover" %}
</header>

{% if self.newsflash %}
  <div class="bg-alert position-relative text-white text-bold py-4">
    <div class="position-absolute w-100 top-50 start-50 pt-1 translate-middle">
      <div id="news-ticker" class="d-none position-relative">
        {% for item in self.featured_items %}
  
          <div class="d-inline-block">
            {{ item.title }} â€¢&nbsp;
          </div>
        {% endfor %}
      </div>
    </div>
  </div>
{% endif %}

<div class="container">
  <main class="bg-white mt-2">
    <form data-filter-form method="GET">
      {% if self.tags %}
        <div class="row">
          <h3 class="microcopy">
            Filters
          </h3>

          {% filter_toggles field=filter_form.theme %}
        </div>
      {% endif %}

      <div class="row">
        {% filter_menu field=filter_form.sort %}

        <input class="form-control" name="query" aria-label="Search query" value="{{filter_form.query.value}}">
      </div>
    </form>
  </div>

  {% if self.style == 'COMPACT' %}
  <div class="container square-grid" {% infinite_scroll_container item_selector='.card' %}>
    {% for page in child_list_page %}
      <a class="card card-flush mx-2 mb-2 flex-shrink-0" href="{{page.url}}">
        <div class="ratio ratio-1x1">
          {% image page.photo width-600 class="card-img-top cover ratio" %}
        </div>

        <div class="card-body mw-100">
          <h2 class="card-title heading-small pt-2">{{page.title}}</h2>
          <p class="card-text text-sm">
            {% if page.intro_text %}
            {{page.intro_text}}
            {% endif %}
          </p>
        </div>
      </a>
    {% endfor %}
  </div>
  {% elif self.style == 'EXPANDED' %}
  <div class="containers bg-white mb-4" {% infinite_scroll_container item_selector='.card' %}>
    {% for page in child_list_page %}
      {% include "stopwatch/includes/article-list-item.html" with page=page %}
    {% endfor %}
  </div>
  {% endif %}
</main>

{% endblock content %}


{% block extra_js %}
{% bind_filter_form %}
{% if self.newsflash %}
<script
  src="https://cdn.jsdelivr.net/npm/dynamic-marquee@2"
></script>
<script>
  (function initNewsTicker() {
    const Marquee = dynamicMarquee.Marquee;
    const loop = dynamicMarquee.loop;
    const tickerEl = document.getElementById('news-ticker')

    const tickerItems = Array.from(tickerEl.children)
    tickerItems.forEach(child => {
      child.remove()
    })

    const marquee = new Marquee(tickerEl, {
      rate: -100,
    });

    tickerEl.classList.remove('d-none')
    loop(marquee, tickerItems.map(item => () => item.cloneNode(true)))
  })()
</script>
{% endif %}
{% endblock %}
